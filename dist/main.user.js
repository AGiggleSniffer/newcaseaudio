// ==UserScript==
// @name         New Case Audio
// @tag          audio
// @namespace    http://tampermonkey.net/
// @version      2.1.4
// @description  Audio output when a new case is detected
// @author       Chris
// @match        https://necam.servicenowservices.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=servicenowservices.com
// @grant        none
// @run-at       document-end
// @downloadURL  https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/main.user.js
// @updateURL    https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/main.user.js
// ==/UserScript==

(function(e){typeof define==`function`&&define.amd?define([],e):e()})(function(){let e=new Audio(`https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/arc_probe.mp3`),t=5e3;var n=6e4;let r=()=>n,i=e=>n=e;function a(){let e=null,t=null,n=null,r=document.querySelector(`[app-id]`);if(!r)return console.warn(`Could not find app element`),{sidebar:e,cases:t,refresh:n};let i=[r];for(;i.length;){let r=i.pop();if(r!=null){try{if(e||=r.querySelector(`sn-canvas-toolbar`),t||=r.querySelector(`tbody`),!n){let e=r.querySelector(`sn-record-list-declarative-actions-wrapper`)?.shadowRoot?.childNodes[0];if(!(e instanceof HTMLElement))throw TypeError(`Not HTMLElement`);n=e?.shadowRoot?.childNodes[0].childNodes[0].childNodes[0].childNodes[0]}}catch(e){e instanceof TypeError||console.error(e)}if(!e||!t||!n)r?.shadowRoot?.childNodes.forEach(e=>{e instanceof HTMLElement&&i.push(e)}),r?.childNodes.forEach(e=>{e instanceof HTMLElement&&i.push(e)});else break}}return{sidebar:e,cases:t,refresh:n}}var o=()=>{let e=document.createElement(`form`);e.style.position=`fixed`,e.style.left=`50px`,e.style.marginTop=`-46.5px`,e.style.zIndex=`1000`,e.style.display=`none`,e.style.backgroundColor=`white`,e.style.padding=`10px`,e.style.border=`1px solid black`,e.style.borderRadius=`5px`,e.style.cursor=`pointer`;let t=document.createElement(`button`);t.type=`submit`,t.innerText=`Save`,t.style.marginRight=`5px`,t.style.marginLeft=`5px`,t.style.cursor=`pointer`;let n=document.createElement(`button`);n.type=`button`,n.innerText=`Cancel`,n.style.cursor=`pointer`,n.onclick=t=>{t.preventDefault(),e.style.display=`none`};let i=document.createElement(`input`);return i.value=`${r()/1e3}`,e.appendChild(i),e.appendChild(t),e.appendChild(n),{wrapper:e,saveButton:t,input:i}},s=()=>document.createElement(`div`),c=(e,t,n)=>{let r=document.createElement(`button`);return r.innerText=`Start Timer`,r.style.width=`100%`,r.style.aspectRatio=`1 / 1`,r.style.cursor=`pointer`,r.style.marginBottom=`5px`,{start:r,startLoop:l(r,e,n,t),stopLoop:u(r)}},l=(e,t,n,i)=>{let a=new Set;return o=>(o.preventDefault(),e.innerText=`Stop Timer`,setInterval(d,r(),t,i,n,a))},u=e=>(t,n)=>{t.preventDefault(),clearInterval(n),e.innerText=`Start Timer`},d=(t,n,i,a)=>{t.click(),console.log(`refresh`),i.innerText=`${r()/1e3}`,setTimeout(()=>{let t=a.size;n.querySelectorAll(`tr`).forEach(e=>{let t=e.childNodes[2];t instanceof HTMLElement&&a.add(t.dataset.tooltip??``)}),t<a.size&&e.play(),console.log(a)},2e3)},f=c,p=()=>{let e=document.createElement(`button`);return e.innerText=`${r()/1e3}`,e.style.width=`100%`,e.style.aspectRatio=`1 / 1`,e.style.cursor=`pointer`,{timer:e,startTimer:m(e),stopTimer:h(e)}},m=e=>t=>(t.preventDefault(),e.innerText=`${r()/1e3}`,setInterval(()=>e.innerText=`${e.innerText-1}`,1e3)),h=e=>(t,n)=>{t.preventDefault(),clearInterval(n),e.innerText=`${r()/1e3}`},g=p;console.warn(`Waiting ${t/1e3} seconds to start...`),setTimeout(_,t);function _(){let{sidebar:e,cases:t,refresh:n}=a();if(!e||!t||!n){console.warn(`Could not find all elements`),console.log({sidebar:e,cases:t,refresh:n});return}let{timer:r,startTimer:c,stopTimer:l}=g(),{start:u,startLoop:d,stopLoop:p}=f(n,t,r),{wrapper:m,saveButton:h,input:_}=o(),v,y;u.onclick=e=>{u.innerText===`Start Timer`?(y=c(e),v=d(e)):(l(e,y),p(e,v))},r.onclick=e=>{e.preventDefault(),m.checkVisibility()?m.style.display=`none`:m.style.display=``},h.onclick=e=>{e.preventDefault(),l(e,y),p(e,v),console.log(_?.value),i(Number(_?.value)*1e3),y=c(e),v=d(e),m.style.display=`none`};let b=s();b.appendChild(u),b.appendChild(r),b.appendChild(m),e.shadowRoot?.querySelector(`div.sn-canvas-toolbar-group`)?.appendChild(b)}});