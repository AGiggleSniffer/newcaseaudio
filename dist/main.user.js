// ==UserScript==
// @name         New Case Audio
// @tag          audio
// @namespace    http://tampermonkey.net/
// @version      2.1.3
// @description  Audio output when a new case is detected
// @author       Chris
// @match        https://necam.servicenowservices.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=servicenowservices.com
// @grant        none
// @run-at       document-end
// @downloadURL  https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/index.user.js
// @updateURL    https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/index.user.js
// ==/UserScript==

(function(e){typeof define==`function`&&define.amd?define([],e):e()})(function(){let e=5e3;var t=6e4;let n=()=>t,r=e=>t=e;function i(){let e=null,t=null,n=null,r=document.querySelector(`[app-id]`);if(!r)return console.warn(`Could not find app element`),{sidebar:e,cases:t,refresh:n};let i=[r];for(;i.length;){let r=i.pop();if(r!=null){try{if(e||=r.querySelector(`sn-canvas-toolbar`),t||=r.querySelector(`tbody`),!n){let e=r.querySelector(`sn-record-list-declarative-actions-wrapper`)?.shadowRoot?.childNodes[0];if(!(e instanceof HTMLElement))throw TypeError(`Not HTMLElement`);n=e?.shadowRoot?.childNodes[0].childNodes[0].childNodes[0].childNodes[0]}}catch(e){e instanceof TypeError||console.error(e)}if(!e||!t||!n)r?.shadowRoot?.childNodes.forEach(e=>{e instanceof HTMLElement&&i.push(e)}),r?.childNodes.forEach(e=>{e instanceof HTMLElement&&i.push(e)});else break}}return{sidebar:e,cases:t,refresh:n}}var a=()=>{let e=document.createElement(`form`);e.style.position=`fixed`,e.style.left=`50px`,e.style.marginTop=`-46.5px`,e.style.zIndex=`1000`,e.style.display=`none`,e.style.backgroundColor=`white`,e.style.padding=`10px`,e.style.border=`1px solid black`,e.style.borderRadius=`5px`,e.style.cursor=`pointer`;let t=document.createElement(`button`);t.type=`submit`,t.innerText=`Save`,t.style.marginRight=`5px`,t.style.marginLeft=`5px`,t.style.cursor=`pointer`;let r=document.createElement(`button`);r.type=`button`,r.innerText=`Cancel`,r.style.cursor=`pointer`,r.onclick=t=>{t.preventDefault(),e.style.display=`none`};let i=document.createElement(`input`);return i.value=`${n()/1e3}`,e.appendChild(i),e.appendChild(t),e.appendChild(r),{wrapper:e,saveButton:t,input:i}},o=()=>document.createElement(`div`),s=(e,t,n)=>{let r=document.createElement(`button`);return r.innerText=`Start Timer`,r.style.width=`100%`,r.style.aspectRatio=`1 / 1`,r.style.cursor=`pointer`,r.style.marginBottom=`5px`,{start:r,startLoop:c(r,e,n,t),stopLoop:l(r)}},c=(e,t,r,i)=>{let a=new Set;return o=>(o.preventDefault(),e.innerText=`Stop Timer`,setInterval(u,n(),t,i,r,a))},l=e=>(t,n)=>{t.preventDefault(),clearInterval(n),e.innerText=`Start Timer`},u=(e,t,r,i)=>{let a=new Audio(`https://dw.zobj.net/download/v1/bIhGBewc6ZkspxCSDinGP9RFZDTmSQ3aydiirpCl22grL9AXh3Q7zi7Zx8tqM5bzBWyDuSBRgjAi0oZvYJ3-fGzkmY2F0ChxpxrQplO9aaVZjMY2SeT_WD9BWCfw/?a=&c=72&f=arc_probe.mp3&special=1764697421-9X3DBzgUwkBYR1umAkIktfg9dQepMu5f4Rru3fVJQwo%3D`);e.click(),console.log(`refresh`),r.innerText=`${n()/1e3}`,setTimeout(()=>{let e=i.size;t.querySelectorAll(`tr`).forEach(e=>{let t=e.childNodes[2];t instanceof HTMLElement&&i.add(t.dataset.tooltip??``)}),e<i.size&&a.play(),console.log(i)},2e3)},d=s,f=()=>{let e=document.createElement(`button`);return e.innerText=`${n()/1e3}`,e.style.width=`100%`,e.style.aspectRatio=`1 / 1`,e.style.cursor=`pointer`,{timer:e,startTimer:p(e),stopTimer:m(e)}},p=e=>t=>(t.preventDefault(),e.innerText=`${n()/1e3}`,setInterval(()=>e.innerText=`${e.innerText-1}`,1e3)),m=e=>(t,r)=>{t.preventDefault(),clearInterval(r),e.innerText=`${n()/1e3}`},h=f;console.warn(`Waiting ${e/1e3} seconds to start...`),setTimeout(g,e);function g(){let{sidebar:e,cases:t,refresh:n}=i();if(!e||!t||!n){console.warn(`Could not find all elements`),console.log({sidebar:e,cases:t,refresh:n});return}let{timer:s,startTimer:c,stopTimer:l}=h(),{start:u,startLoop:f,stopLoop:p}=d(n,t,s),{wrapper:m,saveButton:g,input:_}=a(),v,y;u.onclick=e=>{u.innerText===`Start Timer`?(y=c(e),v=f(e)):(l(e,y),p(e,v))},s.onclick=e=>{e.preventDefault(),m.checkVisibility()?m.style.display=`none`:m.style.display=``},g.onclick=e=>{e.preventDefault(),l(e,y),p(e,v),console.log(_?.value),r(Number(_?.value)*1e3),y=c(e),v=f(e),m.style.display=`none`};let b=o();b.appendChild(u),b.appendChild(s),b.appendChild(m),e.shadowRoot?.querySelector(`div.sn-canvas-toolbar-group`)?.appendChild(b)}});