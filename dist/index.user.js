// ==UserScript==
// @name         New Case Audio
// @tag          audio
// @namespace    http://tampermonkey.net/
// @version      v2.0
// @description  Audio output when a new case is detected
// @author       Chris
// @match        https://necam.servicenowservices.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=servicenowservices.com
// @grant        none
// @run-at       document-end
// @downloadURL  https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/index.user.js
// @updateURL    https://raw.githubusercontent.com/AGiggleSniffer/newcaseaudio/refs/heads/main/dist/index.user.js
// ==/UserScript==

(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})(),(function(){let e=5e3;console.warn(`Waiting ${e/1e3} seconds to start...`),setTimeout(r,e)})();var e=`https://dw.zobj.net/download/v1/bIhGBewc6ZkspxCSDinGP9RFZDTmSQ3aydiirpCl22grL9AXh3Q7zi7Zx8tqM5bzBWyDuSBRgjAi0oZvYJ3-fGzkmY2F0ChxpxrQplO9aaVZjMY2SeT_WD9BWCfw/?a=&c=72&f=arc_probe.mp3&special=1764697421-9X3DBzgUwkBYR1umAkIktfg9dQepMu5f4Rru3fVJQwo%3D`,t=6e4,n=2e3;function r(){let{sidebar:t,cases:n,refresh:r}=i();if(!t||!n||!r){console.warn(`Could not find all elements`),console.log({sidebar:t,cases:n,refresh:r});return}let o=document.createElement(`button`);o.innerText=`Start Timer`,t.shadowRoot?.querySelector(`div.sn-canvas-toolbar-group`)?.appendChild(o),o.onclick=a(new Set,n,o,r,new Audio(e))}function i(){let e=null,t=null,n=null,r={sidebar:e,cases:t,refresh:n},i=document.querySelector(`[app-id]`);if(!i)return console.warn(`Could not find app element`),r;let a=[i];for(;a.length;){let r=a.pop();if(r!=null){console.log(`looping...`);try{if(console.log(`Trying...`),console.log(r,{sidebar:e,cases:t,refresh:n}),e||=r.querySelector(`sn-canvas-toolbar`),t||=r.querySelector(`tbody`),!n){let e=r.querySelector(`sn-record-list-declarative-actions-wrapper`)?.shadowRoot?.childNodes[0];if(!(e instanceof HTMLElement))continue;n=e?.shadowRoot?.childNodes[0].childNodes[0].childNodes[0].childNodes[0]}}catch(e){e instanceof TypeError||console.warn(e)}if(console.log(`Check Check`,{sidebar:e,cases:t,refresh:n}),!e||!t||!n)console.log(`Continuing search...`),r?.shadowRoot?.childNodes.forEach(e=>{console.log(e),e instanceof HTMLElement&&a.push(e)}),r?.childNodes.forEach(e=>{console.log(e),e instanceof HTMLElement&&a.push(e)});else break}}return r}function a(e,r,i,a,o){return()=>{i.innerText=`60`,setInterval(()=>{i.innerText=`${Number(i.innerText)-1}`},1e3),setInterval(()=>{i.innerText=`60`,a.click(),console.log(`refresh`),setTimeout(()=>{let t=e.size;r.querySelectorAll(`tr`).forEach(t=>{let n=t.childNodes[2];n instanceof HTMLElement&&e.add(n.dataset.tooltip??``)}),t<e.size&&o.play(),console.log(e)},n)},t),i.disabled=!0}}